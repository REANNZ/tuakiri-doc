---
redirect_from: Installing+Shibboleth+SP+on+RedHat+based+Linux
id: service_providers/installing_shibboleth_sp_on_redhat_based_linux
---
# Installing Shibboleth SP on RedHat based Linux
{:.no_toc}

# Introduction

{% include service_providers/shibsp-excerpt-intro-part1.md %}

This documentation has been tested on RHEL/CentOS 6 and 7, but should work on other RedHat-based systems as well.

{% include service_providers/shibsp-excerpt-intro-part2.md %}

1. TOC
{:toc}

# Prerequisites

## Firewall settings

{% include service_providers/shibsp-excerpt-prereq-firewall.md %}

## Time synchronization

{% include service_providers/shibsp-excerpt-prereq-timesync.md %}

## Dependencies

Before starting to build and configure the Shibboleth Sevice Provider, be sure that the dependent packages (Apache, and the `mod_ssl` module for Apache) are installed:

```
yum install httpd mod_ssl
```

## SELinux

**Configuring SELinux to permit httpd-shibd communication**

  
> **Note**  
These steps are required on an RHEL6/CentOS6 system with SELinux running in Enforcing mode - otherwise, `mod_shib` running inside Apache would not be able to communicate with `shibd`.
>
On RHEL7/CentOS7, the default SELinux policy already permits these actions and the following step is not required.

  

<details markdown="1">
<summary>Click here to expand the instructions to configure SELinux to permit httpd-shibd communication on a CentOS-6 system</summary>

To configure SELinux to allow Apache (where `mod_shib` is loaded) to connect to `shibd`:

*   Create a policy type enforcement file defining a policy module `mod_shib-to-shibd` - create `mod_shib-to-shibd.te` with the following contents:
    
    ```
    module mod_shib-to-shibd 1.0;
    
    require {
            type var_run_t;
            type httpd_t;
            type initrc_t;
            class sock_file write;
            class unix_stream_socket connectto;
    }
    
    #============= httpd_t ==============
    allow httpd_t initrc_t:unix_stream_socket connectto;
    allow httpd_t var_run_t:sock_file write;
    ```
    

*   Compile, package and load the module with:
    
    ```
    checkmodule -m -M -o mod_shib-to-shibd.mod mod_shib-to-shibd.te 
    semodule_package -o mod_shib-to-shibd.pp -m mod_shib-to-shibd.mod
    semodule -i mod_shib-to-shibd.pp 
    ```
    
</details>

# Installation

Shibboleth SP is available for RedHat and derivative distributions via yum repositories maintained by the Shibboleth Project.  The repository configuration files are generated by the shibbolet.net download site based on the target Linux distribution.  You can either download the `.repo`  file directly by passing in the distribution name as per the examples below, or you can download it via a browser from [https://shibboleth.net/downloads/service-provider/latest/RPMS/](https://shibboleth.net/downloads/service-provider/latest/RPMS/) and then copy it to the target system.

*   Add the `yum` repository for your distribution (example for CentOS 7):
    
    ```
    wget -O /etc/yum.repos.d/shibboleth.repo https://shibboleth.net/cgi-bin/sp_repo.cgi?platform=CentOS_7 
    ```
    
      
    The table below includes links for additional supported distributions (taken from the download form linked above)
    
    |     |     |
    | --- | --- |
    | Platform (OS) | URL |
    | CentOS 8 and RHEL 8 | [https://shibboleth.net/cgi-bin/sp\_repo.cgi?platform=CentOS\_8](https://shibboleth.net/cgi-bin/sp_repo.cgi?platform=CentOS_8) |
    | CentOS 7 and RHEL 7 | [https://shibboleth.net/cgi-bin/sp\_repo.cgi?platform=CentOS\_7](https://shibboleth.net/cgi-bin/sp_repo.cgi?platform=CentOS_7) |
    | Rocky Linux 8 | [https://shibboleth.net/cgi-bin/sp\_repo.cgi?platform=rockylinux8](https://shibboleth.net/cgi-bin/sp_repo.cgi?platform=rockylinux8) |
    | Rocky Linux 9 | [https://shibboleth.net/cgi-bin/sp\_repo.cgi?platform=rockylinux9](https://shibboleth.net/cgi-bin/sp_repo.cgi?platform=rockylinux9) |
    | Amazon Linux 2 | [https://shibboleth.net/cgi-bin/sp\_repo.cgi?platform=amazonlinux2](https://shibboleth.net/cgi-bin/sp_repo.cgi?platform=amazonlinux2) |
    | Amazon Linux 2023 | [https://shibboleth.net/cgi-bin/sp\_repo.cgi?platform=amazonlinux2023](https://shibboleth.net/cgi-bin/sp_repo.cgi?platform=amazonlinux2023) |
    
    RHEL 7 RPMs
    
    The Shibboleth Project provides binary packages for CentOS systems, but due to licensing restrictions, cannot build packages for RHEL 7 and above - full details are at [https://wiki.shibboleth.net/confluence/display/SP3/RPMInstall](https://wiki.shibboleth.net/confluence/display/SP3/RPMInstall).
    
    For RHEL 7 systems, please use the binary-compatible CentOS repository.
    
    For RHEL version 8 and above, Rocky Linux is a supported alternative.
    
*   Install latest version via `yum`:
    
    ```
    yum install shibboleth
    ```
    

# Federation Membership

{% include federation_management/adding_an_sp_to_tuakiri-excerpt.md %}

## Configuration

{% include service_providers/shibsp-excerpt-configuration.md %}

*   With earlier versions of Shibboleth SP (2.x), it was necessary to work around issues with rotation of logs generated by the `mod_shib`  module running inside Apache.  In Shibboleth SP 3.x, this module logs via syslog and this is no longer an issue.  If deploying a 2.x installation or explicitly logging to file, expand this section (otherwise archived for historical purposes only).
    
    <details markdown="1">
    <summary>Click here to expand...</summary>
    
    Workaround : move the log rotation from the module to logrotate.
    
    *   Otherwise, SELinux rules would not permit the log rotation (by design Apache is allowed to only _append_ to logs, but cannot remove them – incl. renaming).
    *   And there is also a race condition in the log rotation.  This has been reported upstream as [SSPCPP-757](https://issues.shibboleth.net/jira/browse/SSPCPP-757) - and we recommend to move log rotation out of `mod_shib` to `logrotate`.  
          
        
    *   Edit `/etc/shibboleth/native.logger`  and:
        *   replace `RollingFileAppender` with `FileAppender`
        *   comment out log rotation-specific options: `maxFileSize` and `maxBackupIndex`
        *   or just replace the file with our copy with exactly these customizations: [native.logger](https://github.com/REANNZ/Tuakiri-public/raw/master/shibboleth-sp/native.logger)
    *   Install a new file into `/etc/logrotate.d/shibboleth-www` to rotate these files via `logrotate` (and reload Apache post-rotate): [shibboleth-www](https://github.com/REANNZ/Tuakiri-public/raw/master/shibboleth-sp/logrotate-redhat/shibboleth-www) containing:
        
          
        
        ```
        /var/log/shibboleth-www/*.log {
            missingok
            daily
            rotate 10
            nodateext
            size 1000000
            sharedscripts
            postrotate
                /sbin/service httpd reload > /dev/null 2>/dev/null || true
            endscript
        }
        ```
        
    *   These can be both installed with:
        
        ```
        wget -O /etc/shibboleth/native.logger https://github.com/REANNZ/Tuakiri-public/raw/master/shibboleth-sp/native.logger
        wget -O /etc/logrotate.d/shibboleth-www https://github.com/REANNZ/Tuakiri-public/raw/master/shibboleth-sp/logrotate-redhat/shibboleth-www
        ```
        
    </details>
    

# Special considerations

## HTTP/HTTPS access

{% include service_providers/shibsp-excerpt-special-http-https.md %}

## RedHat Enterprise Linux 6 and 7

Please note that RedHat Enterprise Linux 6 and 7 (and so also CentOS 6 and 7) come with CURL built against NSS, not OpenSSL. Using this version of the CURL libraries would break the SOAP calls Shibboleth SP is making to the IdP port 8443 (back-channel communication) for artifact resolution and attribute queries.  While initial approach taken by the Shibboleth SP project was to provide CURL version linked against OpenSSL that would "upgrade" (replace) the one that comes with the OS, this was later seen as having undesired consequences and the new approach is to instead provide "look-aside" version of the library that installs into `/opt`.

These libraries install automatically as dependencies of the main shibboleth package and no action is needed by the deployer.

Further information is available in the upstream documentation at [https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPLinuxRH6](https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPLinuxRH6)

## ECP

{% include service_providers/shibsp-excerpt-special-ecp.md %}

# Logging

{% include service_providers/shibsp-excerpt-logging.md %}

# Protecting a resource

{% include service_providers/shibsp-excerpt-protect-resource.md %}

# Finishing up

  

*   Start up Apache and shibd:
    
    ```
     service httpd start
     service shibd start
     chkconfig httpd on
     chkconfig shibd on
    ```
    
    On RHEL7/CentOS7 using systemd, the commands should properly be:
    
    ```
    systemctl enable httpd shibd
    systemctl start httpd shibd
    ```
    
    (but the legacy syntax invoking `service` and `chkconfig` still works and is rerouted to systemctl)
    

# Testing

{% include service_providers/shibsp-excerpt-testing.md %}
